<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>房屋管理系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.4.4/css/tabulator_mobile.min.css">
    <style>
        /* 原始样式保留 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            display: none;
            z-index: 1000;
        }
        .modal-content {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 75vh;
            background: white;
            padding: 20px;
            overflow-y: auto;
        }
    </style>
    <script>
        window._AMapSecurityConfig = {
            securityJsCode: '6dc8e1105738b3c7f8a200f1ab73efb5'
        };
    </script>
    <script src="https://webapi.amap.com/maps?v=2.0&key=81af62ba5eb2df43dce2f2e564caa0ae"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.4.4/js/tabulator.min.js"></script>
</head>
<body>
    <!-- 原始结构保持不变 -->
    <div id="mapContainer" style="width:100%;height:60vh;"></div>
    <div style="padding:10px;">
        <button onclick="showForm()">📝 新建</button>
        <button onclick="locateUser()">📍 定位</button>
        <button onclick="showData()">📋 数据</button>
    </div>

    <!-- 数据弹窗修复 -->
    <div class="modal" id="dataModal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <h3>数据管理</h3>
                <button onclick="document.getElementById('dataModal').style.display='none'" 
                        style="background:#ff4d4f;color:white;border:none;padding:5px 10px;">关闭</button>
            </div>
            <button onclick="exportExcel()">导出</button>
            <input type="file" id="importFile" onchange="importExcel()" accept=".xlsx">
            <div id="dataTable"></div>
        </div>
    </div>

    <script>
        // 数据表格配置（电话字段修复）
        const dataTable = new Tabulator("#dataTable", {
            columns: [
                {title:"户号", field:"number"},
                {title:"户名", field:"name"},
                {title:"电话", field:"phone"}, // 新增字段
                {title:"地址", field:"address"},
                {title:"操作", formatter:()=>'<button>删除</button>'}
            ],
            data: []
        });

        // 导出功能修复
        function exportExcel() {
            dataTable.download("xlsx", "数据.xlsx", {
                columns:["number","name","phone","address"] // 包含电话字段
            });
        }

        // 地图标记点击修复
        function createMarker(item) {
            const marker = new AMap.Marker({
                position: item.lnglat,
                content: `<div style="background:#1890ff;color:white;padding:5px;">${item.number}</div>`
            });
            
            marker.on('click', () => {
                new AMap.InfoWindow({
                    content: `<div style="padding:10px;">
                                <h4>${item.name}</h4>
                                <p>户号：${item.number}</p>
                                <p>电话：${item.phone || '无'}</p>
                                <p>地址：${item.address}</p>
                              </div>`
                }).open(map, marker.getPosition());
            });
            return marker;
        }

        /* 以下为原始代码保持不变 */
        let map, houseData = [];
        
        function initMap() {
            map = new AMap.Map('mapContainer', { zoom: 17 });
            // 其他初始化代码...
        }
        
        function showForm() { /* 原始表单逻辑 */ }
        function locateUser() { /* 原始定位逻辑 */ }
        function showData() { /* 原始数据显示逻辑 */ }
        
        window.onload = initMap;
    </script>
</body>
</html>